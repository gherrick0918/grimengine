PS C:\dev\grimengine> pnpm -w build; `
>> pnpm test; `
>> pnpm dev -- settings set respect-adv on; `
>> pnpm dev -- encounter start; `
>> pnpm dev -- character load-name "Bruni"; `
>> pnpm dev -- encounter add pc "Bruni"; `
>> pnpm dev -- character load-name "Kara"; `
>> pnpm dev -- encounter add pc "Kara"; `
>> pnpm dev -- encounter add goblin --n 2; `
>> pnpm dev -- encounter bless "Bruni" "Bruni,Kara"; `
>> pnpm dev -- encounter mark "Kara" "Goblin #1"; `
>> pnpm dev -- encounter guidance "Bruni" "Kara"; `
>> pnpm dev -- encounter inspire "Bruni" "Kara" --die d8; `
>> pnpm dev -- encounter prone "Goblin #1" on; `
>> pnpm dev -- encounter save "kitchen-sink"; `
>> pnpm dev -- encounter clear party; `
>> pnpm dev -- encounter load "kitchen-sink"; `
>> pnpm dev -- encounter list; `
>> pnpm dev -- encounter end

> grimengine@1.0.0 build C:\dev\grimengine
> turbo run build

turbo 2.5.8

• Packages in scope: @grimengine/cli, @grimengine/core, @grimengine/dnd5e-api, @grimengine/rules-srd
• Running build in 4 packages
• Remote caching disabled

No tasks were executed as part of this run.

 Tasks:    0 successful, 0 total
Cached:    0 cached, 0 total
  Time:    336ms

                                                                                                                                                     
> grimengine@1.0.0 test C:\dev\grimengine
> turbo run test

turbo 2.5.8

• Packages in scope: @grimengine/cli, @grimengine/core, @grimengine/dnd5e-api, @grimengine/rules-srd
• Running test in 4 packages
• Remote caching disabled
@grimengine/core:test: cache miss, executing 56fb30f9873be1bc
@grimengine/cli:test: cache miss, executing fc8a1e8110f4ea32
@grimengine/cli:test: 
@grimengine/cli:test: > @grimengine/cli@0.0.0 test C:\dev\grimengine\apps\cli
@grimengine/cli:test: > vitest --config vitest.config.ts
@grimengine/cli:test:
@grimengine/core:test:
@grimengine/core:test: > @grimengine/core@0.0.0 test C:\dev\grimengine\packages\core
@grimengine/core:test: > vitest --config vitest.config.ts
@grimengine/core:test:
@grimengine/cli:test: 
@grimengine/core:test: 
@grimengine/core:test:  RUN  v3.2.4 C:/dev/grimengine/packages/core
@grimengine/cli:test:  RUN  v3.2.4 C:/dev/grimengine/apps/cli
@grimengine/core:test:
@grimengine/cli:test:
@grimengine/core:test:  ✓ tests/logging.test.ts (3 tests) 51ms
@grimengine/core:test:  ✓ tests/clear.helper.test.ts (2 tests) 9ms
@grimengine/core:test:  ✓ tests/advantage.wire.test.ts (7 tests) 15ms
@grimengine/core:test:  ✓ tests/conditions.test.ts (11 tests) 17ms
@grimengine/core:test:  ✓ tests/spells.test.ts (9 tests) 17ms
@grimengine/cli:test:  ✓ tests/encounter-snapshots.test.ts (2 tests) 13ms
@grimengine/cli:test: 
@grimengine/cli:test:  Test Files  1 passed (1)
@grimengine/cli:test:       Tests  2 passed (2)
@grimengine/cli:test:    Start at  10:05:49
@grimengine/cli:test:    Duration  1.58s (transform 711ms, setup 0ms, collect 730ms, tests 13ms, environment 0ms, prepare 337ms)
@grimengine/cli:test:
@grimengine/core:test:  ✓ tests/compendium.seed.test.ts (3 tests) 82ms
@grimengine/core:test:  ❯ tests/compendium.builder.test.ts (3 tests | 1 failed) 191ms
@grimengine/core:test:    × compendium encounter builder > imports monsters from directories and files with generated slugs 77ms
@grimengine/core:test:      → expected { ok: true, count: 5 } to deeply equal { ok: true, count: 2 }
@grimengine/core:test:    ✓ compendium encounter builder > builds encounters from compendium specs with numbering and side assignment 7ms
@grimengine/core:test:    ✓ compendium encounter builder > falls back to builtin templates when compendium entry is missing 105ms
@grimengine/core:test:  ✓ tests/combat.test.ts (8 tests) 15ms
@grimengine/core:test:  ✓ tests/encounter-checks.test.ts (4 tests) 11ms
@grimengine/core:test:  ✓ tests/encounter.test.ts (3 tests) 13ms
@grimengine/core:test:  ✓ tests/bless.test.ts (3 tests) 12ms
@grimengine/core:test:  ✓ tests/weapons.test.ts (6 tests) 15ms
@grimengine/core:test:  ✓ tests/rest.test.ts (3 tests) 12ms
@grimengine/core:test:  ✓ tests/tags.test.ts (3 tests) 11ms
@grimengine/core:test:  ✓ tests/initiative.test.ts (3 tests) 12ms
@grimengine/core:test:  ✓ tests/huntersMark.test.ts (4 tests) 14ms
@grimengine/core:test:  ✓ tests/abilityScores.test.ts (9 tests) 16ms
@grimengine/core:test:  ✓ tests/character.test.ts (6 tests) 12ms
@grimengine/core:test:  ✓ tests/advdis.reminders.test.ts (3 tests) 9ms
@grimengine/core:test:  ✓ tests/reminders.test.ts (4 tests) 15ms
@grimengine/core:test:  ✓ tests/turns.duration.test.ts (3 tests) 9ms
@grimengine/core:test:  ✓ tests/derived.test.ts (7 tests) 9ms
@grimengine/core:test:  ✓ tests/loot.test.ts (5 tests) 9ms
@grimengine/core:test:  ✓ tests/guidance_bi_reminders.test.ts (4 tests) 10ms
@grimengine/core:test:  ✓ tests/slots.test.ts (5 tests) 13ms
@grimengine/core:test:  ✓ tests/conditions.reminders.test.ts (3 tests) 9ms
@grimengine/core:test:  ✓ tests/checks.test.ts (5 tests) 10ms
@grimengine/core:test:  ✓ tests/bardicInspiration.consume.test.ts (2 tests) 8ms
@grimengine/core:test:  ✓ tests/concentrationDamageReminders.test.ts (4 tests) 9ms
@grimengine/core:test:  ✓ tests/skills.test.ts (4 tests) 9ms
@grimengine/core:test:  ✓ tests/death.test.ts (6 tests) 10ms
@grimengine/core:test:  ✓ tests/dice.test.ts (4 tests) 8ms
@grimengine/core:test:  ✓ tests/concentration.test.ts (3 tests) 9ms
@grimengine/core:test:  ✓ tests/monster-normalize.test.ts (1 test) 5ms
@grimengine/core:test:  ✓ tests/derivationParity.test.ts (3 tests) 7ms
@grimengine/core:test: 
@grimengine/core:test: ⎯⎯⎯⎯⎯⎯⎯ Failed Tests 1 ⎯⎯⎯⎯⎯⎯⎯
@grimengine/core:test:
@grimengine/core:test:  FAIL  tests/compendium.builder.test.ts > compendium encounter builder > imports monsters from directories and files with generated slugs
@grimengine/core:test: AssertionError: expected { ok: true, count: 5 } to deeply equal { ok: true, count: 2 }
@grimengine/core:test:
@grimengine/core:test: - Expected
@grimengine/core:test: + Received
@grimengine/core:test:
@grimengine/core:test:   {
@grimengine/core:test: -   "count": 2,
@grimengine/core:test: +   "count": 5,
@grimengine/core:test:     "ok": true,
@grimengine/core:test:   }
@grimengine/core:test:
@grimengine/core:test:  ❯ tests/compendium.builder.test.ts:43:23
@grimengine/core:test:      41| 
@grimengine/core:test:      42|     const dirResult = await importMonsters(sourceDir);
@grimengine/core:test:      43|     expect(dirResult).toEqual({ ok: true, count: 2 });
@grimengine/core:test:        |                       ^
@grimengine/core:test:      44|
@grimengine/core:test:      45|     const singlePath = join(tempDir, 'captain.json');
@grimengine/core:test:
@grimengine/core:test:
@grimengine/core:test: ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/1]⎯
@grimengine/core:test:
@grimengine/core:test:  Test Files  1 failed | 34 passed (35)
@grimengine/core:test:       Tests  1 failed | 155 passed (156)
@grimengine/core:test:    Start at  10:05:49
@grimengine/core:test:    Duration  4.62s (transform 1.73s, setup 0ms, collect 4.80s, tests 682ms, environment 19ms, prepare 9.34s)
@grimengine/core:test:
@grimengine/core:test:  ELIFECYCLE  Test failed. See above for more details.
@grimengine/core:test: ERROR: command finished with error: command (C:\dev\grimengine\packages\core) C:\Users\gherr\AppData\Roaming\npm\pnpm.cmd run test exited (1)
@grimengine/core#test: command (C:\dev\grimengine\packages\core) C:\Users\gherr\AppData\Roaming\npm\pnpm.cmd run test exited (1)

 Tasks:    1 successful, 2 total
Cached:    0 cached, 2 total
  Time:    6.748s
Failed:    @grimengine/core#test

 ERROR  run failed: command  exited (1)
 ELIFECYCLE  Test failed. See above for more details.

> grimengine@1.0.0 dev C:\dev\grimengine
> tsx apps/cli/index.ts "settings" "set" "respect-adv" "on"

respectAdv = ON

> grimengine@1.0.0 dev C:\dev\grimengine
> tsx apps/cli/index.ts "encounter" "start"

Encounter started.

> grimengine@1.0.0 dev C:\dev\grimengine
> tsx apps/cli/index.ts "character" "load-name" "Bruni"

Loaded character Bruni (lvl 3). PB +2

> grimengine@1.0.0 dev C:\dev\grimengine
> tsx apps/cli/index.ts "encounter" "add" "pc" "Bruni"

Added PC Bruni (id=bruni).

> grimengine@1.0.0 dev C:\dev\grimengine
> tsx apps/cli/index.ts "character" "load-name" "Kara"

Loaded character Kara (lvl 3). PB +2

> grimengine@1.0.0 dev C:\dev\grimengine
> tsx apps/cli/index.ts "encounter" "add" "pc" "Kara"

Added PC Kara (id=kara).

> grimengine@1.0.0 dev C:\dev\grimengine
> tsx apps/cli/index.ts "encounter" "add" "goblin" "--n" "2"

Added 2 Goblins on side 'foe': Goblin #1 (id=goblin-1), Goblin #2 (id=goblin-2)

> grimengine@1.0.0 dev C:\dev\grimengine
> tsx apps/cli/index.ts "encounter" "bless" "Bruni" "Bruni,Kara"

Bless applied: Bruni → Bruni, Kara (concentration started)

> grimengine@1.0.0 dev C:\dev\grimengine
> tsx apps/cli/index.ts "encounter" "mark" "Kara" "Goblin #1"

Started concentration: Hunter's Mark (Kara) → target Goblin #1
Added tag to Goblin #1: "Hunter's Mark" [conc:kara:Hunter's Mark]

> grimengine@1.0.0 dev C:\dev\grimengine
> tsx apps/cli/index.ts "encounter" "guidance" "Bruni" "Kara"

Guidance applied: Bruni → Kara (concentration started)

> grimengine@1.0.0 dev C:\dev\grimengine
> tsx apps/cli/index.ts "encounter" "inspire" "Bruni" "Kara" "--die" "d8"

Bardic Inspiration applied: Bruni → Kara (+d8)

> grimengine@1.0.0 dev C:\dev\grimengine
> tsx apps/cli/index.ts "encounter" "prone" "Goblin #1" "on"

Goblin #1: Prone ON

> grimengine@1.0.0 dev C:\dev\grimengine
> tsx apps/cli/index.ts "encounter" "save" "kitchen-sink"

Saved encounter → .data\encounters\kitchen-sink.json

> grimengine@1.0.0 dev C:\dev\grimengine
> tsx apps/cli/index.ts "encounter" "clear" "party"

Cleared status from 2 actor(s).

> grimengine@1.0.0 dev C:\dev\grimengine
> tsx apps/cli/index.ts "encounter" "load" "kitchen-sink"

Loaded encounter 'kitchen-sink' with 4 actors.

> grimengine@1.0.0 dev C:\dev\grimengine
> tsx apps/cli/index.ts "encounter" "list"

Encounter encounter
Round: 0 | Turn: n/a
Actors:
→ [party] Bruni (id=bruni) AC 18 HP 26/26 [conc: Guidance] — conditions: — — tags: —
  [party] Kara (id=kara) AC 15 HP 27/27 [conc: Hunter's Mark] — conditions: — — tags: Guidance — note: Add 1d4 to a single ability check; source: conc:bruni:guidance, Bardic Inspiration — note: Add d8 to one ability check, attack roll, or saving throw; source: bard:bruni:inspiration
  [foe] Goblin #1 (id=goblin-1) AC 15 HP 7/7 — conditions: — — tags: Hunter's Mark — note: Add 1d6 to your weapon damage rolls against this target; source: conc:kara:Hunter's Mark, Prone
  [foe] Goblin #2 (id=goblin-2) AC 15 HP 7/7 — conditions: — — tags: —

> grimengine@1.0.0 dev C:\dev\grimengine
> tsx apps/cli/index.ts "encounter" "end"

Encounter ended.
PS C:\dev\grimengine> 