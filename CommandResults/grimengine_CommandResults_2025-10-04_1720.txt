PS C:\dev\grimengine> pnpm test                              

> grimengine@1.0.0 test C:\dev\grimengine
> turbo run test

turbo 2.5.8

 WARNING  Unable to calculate transitive closures: Workspace 'packages/adapters/dnd5e-api' not found in lockfile.
• Packages in scope: @grimengine/core, @grimengine/dnd5e-api, @grimengine/rules-srd
• Running test in 3 packages
• Remote caching disabled
@grimengine/core:test: cache miss, executing 4a338f21dbafb4af
@grimengine/core:test: 
@grimengine/core:test: > @grimengine/core@0.0.0 test C:\dev\grimengine\packages\core
@grimengine/core:test: > vitest --config vitest.config.ts
@grimengine/core:test:
@grimengine/core:test: 
@grimengine/core:test:  RUN  v3.2.4 C:/dev/grimengine/packages/core
@grimengine/core:test:
@grimengine/core:test:  ✓ tests/abilityScores.test.ts (9 tests) 12ms
@grimengine/core:test:  ✓ tests/combat.test.ts (8 tests) 14ms
@grimengine/core:test:  ✓ tests/encounter.test.ts (3 tests) 14ms
@grimengine/core:test:  ✓ tests/conditions.test.ts (11 tests) 13ms
@grimengine/core:test:  ✓ tests/derived.test.ts (7 tests) 8ms
@grimengine/core:test:  ✓ tests/skills.test.ts (4 tests) 9ms
@grimengine/core:test:  ✓ tests/character.test.ts (6 tests) 14ms
@grimengine/core:test:  ✓ tests/checks.test.ts (5 tests) 11ms
@grimengine/core:test:  ✓ tests/loot.test.ts (5 tests) 9ms
@grimengine/core:test:  ✓ tests/dice.test.ts (4 tests) 12ms
@grimengine/core:test:  ✓ tests/monster-normalize.test.ts (1 test) 6ms
@grimengine/core:test:  ✓ tests/weapons.test.ts (6 tests) 13ms
@grimengine/core:test: 
@grimengine/core:test:  Test Files  12 passed (12)
@grimengine/core:test:       Tests  69 passed (69)
@grimengine/core:test:    Start at  17:17:12
@grimengine/core:test:    Duration  1.91s (transform 910ms, setup 0ms, collect 1.79s, tests 136ms, environment 4ms, prepare 3.53s)
@grimengine/core:test:

 Tasks:    1 successful, 1 total
Cached:    0 cached, 1 total
  Time:    4.573s

PS C:\dev\grimengine> pnpm dev -- encounter start --seed grim                                                                                        

> grimengine@1.0.0 dev C:\dev\grimengine
> tsx apps/cli/index.ts "encounter" "start" "--seed" "grim"

Encounter started (seed="grim").
PS C:\dev\grimengine> pnpm dev -- character load-name "Aerin"

> grimengine@1.0.0 dev C:\dev\grimengine
> tsx apps/cli/index.ts "character" "load-name" "Aerin"

Loaded character Aerin (lvl 3). PB +2
PS C:\dev\grimengine> pnpm dev -- encounter add pc "Aerin"

> grimengine@1.0.0 dev C:\dev\grimengine
> tsx apps/cli/index.ts "encounter" "add" "pc" "Aerin"

Added PC Aerin (id=aerin).
PS C:\dev\grimengine> pnpm dev -- encounter add monster "Skeleton"

> grimengine@1.0.0 dev C:\dev\grimengine
> tsx apps/cli/index.ts "encounter" "add" "monster" "Skeleton"

Fetched Skeleton from the 5e API.
Added 1 Skeleton: Skeleton #1 (id=skeleton-1)
PS C:\dev\grimengine> pnpm dev -- encounter roll-init

> grimengine@1.0.0 dev C:\dev\grimengine
> tsx apps/cli/index.ts "encounter" "roll-init"

Initiative order:
1. Skeleton #1 (id=skeleton-1) → 12 = 10 + Dex +2
2. Aerin (id=aerin) → 11 = 9 + Dex +2
PS C:\dev\grimengine> pnpm dev -- encounter condition add "Skeleton #1" restrained

> grimengine@1.0.0 dev C:\dev\grimengine
> tsx apps/cli/index.ts "encounter" "condition" "add" "Skeleton #1" "restrained"

Added restrained to Skeleton #1 (id=skeleton-1). Conditions: restrained.
PS C:\dev\grimengine> pnpm dev -- encounter attack "Aerin" "Skeleton #1" --melee --seed grim

> grimengine@1.0.0 dev C:\dev\grimengine
> tsx apps/cli/index.ts "encounter" "attack" "Aerin" "Skeleton #1" "--melee" "--seed" "grim"

Mode: melee (conditions: advantage from defender restrained)
Advantage state: advantage
Attack: 1d20+5 adv vs AC 13
Rolls: [16, 20] → natural 20 → total 25 → CRIT!
Damage: 1d4+3 (crit)
Rolls: [1] + crit [4] → base 8 → final 8
Defender Skeleton #1 (id=skeleton-1) now has 5/13 HP (active).
PS C:\dev\grimengine> pnpm dev -- encounter condition add "Aerin" poisoned

> grimengine@1.0.0 dev C:\dev\grimengine
> tsx apps/cli/index.ts "encounter" "condition" "add" "Aerin" "poisoned"

Added poisoned to Aerin (id=aerin). Conditions: poisoned.
PS C:\dev\grimengine> pnpm dev -- encounter attack "Aerin" "Skeleton #1" --melee --seed grim

> grimengine@1.0.0 dev C:\dev\grimengine
> tsx apps/cli/index.ts "encounter" "attack" "Aerin" "Skeleton #1" "--melee" "--seed" "grim"

Mode: melee (conditions: advantage from defender restrained; disadvantage from attacker poisoned → cancel)
Advantage state: normal
Attack: 1d20+5 vs AC 13
Rolls: [15] → natural 15 → total 20 → HIT
Damage: 1d4+3
Rolls: [1] → base 4 → final 4
Defender Skeleton #1 (id=skeleton-1) now has 1/13 HP (active).
PS C:\dev\grimengine> pnpm dev -- encounter end

> grimengine@1.0.0 dev C:\dev\grimengine
> tsx apps/cli/index.ts "encounter" "end"

Encounter ended.
PS C:\dev\grimengine> pnpm dev -- character unload

> grimengine@1.0.0 dev C:\dev\grimengine
> tsx apps/cli/index.ts "character" "unload"

Character session cleared.
PS C:\dev\grimengine> 