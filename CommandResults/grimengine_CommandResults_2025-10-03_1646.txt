PS C:\dev\grimengine> pnpm test

> grimengine@1.0.0 test C:\dev\grimengine
> turbo run test

turbo 2.5.8

 WARNING  Unable to calculate transitive closures: Workspace 'packages/adapters/dnd5e-api' not found in lockfile.
• Packages in scope: @grimengine/core, @grimengine/dnd5e-api, @grimengine/rules-srd
• Running test in 3 packages
• Remote caching disabled
@grimengine/core:test: cache miss, executing ae88c8ce95a3dfe1
@grimengine/core:test: 
@grimengine/core:test: > @grimengine/core@0.0.0 test C:\dev\grimengine\packages\core
@grimengine/core:test: > vitest --config vitest.config.ts
@grimengine/core:test:
@grimengine/core:test: 
@grimengine/core:test:  RUN  v3.2.4 C:/dev/grimengine/packages/core
@grimengine/core:test:
@grimengine/core:test:  ✓ tests/combat.test.ts (8 tests) 25ms
@grimengine/core:test:  ✓ tests/encounter.test.ts (3 tests) 27ms
@grimengine/core:test:  ✓ tests/abilityScores.test.ts (9 tests) 24ms
@grimengine/core:test:  ❯ tests/conditions.test.ts (11 tests | 2 failed) 44ms
@grimengine/core:test:    ✓ condition helpers > adds, checks, and removes conditions 4ms
@grimengine/core:test:    ✓ attackAdvFromConditions > handles prone defenders for melee attacks 1ms
@grimengine/core:test:    ✓ attackAdvFromConditions > handles prone defenders for ranged attacks 0ms
@grimengine/core:test:    ✓ attackAdvFromConditions > grants advantage against restrained defenders 0ms
@grimengine/core:test:    ✓ attackAdvFromConditions > applies disadvantage to restrained attackers 1ms
@grimengine/core:test:    ✓ attackAdvFromConditions > applies disadvantage to poisoned attackers 0ms
@grimengine/core:test:    ✓ attackAdvFromConditions > can produce both advantage and disadvantage 1ms
@grimengine/core:test:    ✓ combineAdvantage > cancels opposing advantage and disadvantage 1ms
@grimengine/core:test:    ✓ combineAdvantage > merges user-provided and condition flags 1ms
@grimengine/core:test:    × actorAttack integration with conditions > rolls with advantage when the defender is restrained 27ms
@grimengine/core:test:      → expected [ 14, 2 ] to deeply equal [ 20, 13 ]
@grimengine/core:test:    × actorAttack integration with conditions > rolls with disadvantage when the attacker is poisoned 3ms
@grimengine/core:test:      → expected [ 14, 2 ] to deeply equal [ 20, 13 ]
@grimengine/core:test:  ✓ tests/weapons.test.ts (6 tests) 14ms
@grimengine/core:test:  ✓ tests/derived.test.ts (7 tests) 20ms
@grimengine/core:test:  ✓ tests/character.test.ts (6 tests) 29ms
@grimengine/core:test:  ✓ tests/loot.test.ts (5 tests) 15ms
@grimengine/core:test:  ✓ tests/checks.test.ts (5 tests) 19ms
@grimengine/core:test:  ✓ tests/monster-normalize.test.ts (1 test) 14ms
@grimengine/core:test:  ✓ tests/dice.test.ts (4 tests) 13ms
@grimengine/core:test:  ✓ tests/skills.test.ts (4 tests) 23ms
@grimengine/core:test: 
@grimengine/core:test: ⎯⎯⎯⎯⎯⎯⎯ Failed Tests 2 ⎯⎯⎯⎯⎯⎯⎯
@grimengine/core:test:
@grimengine/core:test:  FAIL  tests/conditions.test.ts > actorAttack integration with conditions > rolls with advantage when the defender is restrained
@grimengine/core:test: AssertionError: expected [ 14, 2 ] to deeply equal [ 20, 13 ]
@grimengine/core:test:
@grimengine/core:test: - Expected
@grimengine/core:test: + Received
@grimengine/core:test:
@grimengine/core:test:   [
@grimengine/core:test: -   20,
@grimengine/core:test: -   13,
@grimengine/core:test: +   14,
@grimengine/core:test: +   2,
@grimengine/core:test:   ]
@grimengine/core:test:
@grimengine/core:test:  ❯ tests/conditions.test.ts:100:32
@grimengine/core:test:      98| 
@grimengine/core:test:      99|     const result = actorAttack(encounter, attacker.id, defender.id, { …
@grimengine/core:test:     100|     expect(result.attack.d20s).toEqual([20, 13]);
@grimengine/core:test:        |                                ^
@grimengine/core:test:     101|     expect(result.attack.natural).toBe(20);
@grimengine/core:test:     102|     expect(result.attack.expression).toContain('adv');
@grimengine/core:test:
@grimengine/core:test: ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/2]⎯
@grimengine/core:test:
@grimengine/core:test:  FAIL  tests/conditions.test.ts > actorAttack integration with conditions > rolls with disadvantage when the attacker is poisoned
@grimengine/core:test: AssertionError: expected [ 14, 2 ] to deeply equal [ 20, 13 ]
@grimengine/core:test:
@grimengine/core:test:
@grimengine/core:test: - Expected
@grimengine/core:test:  Test Files  1 failed | 11 passed (12)
@grimengine/core:test:       Tests  2 failed | 67 passed (69)
@grimengine/core:test:    Start at  16:39:30
@grimengine/core:test: + Received
@grimengine/core:test:    Duration  2.49s (transform 1.01s, setup 0ms, collect 2.40s, tests 267ms, environment 5ms, prepare 4.88s)
@grimengine/core:test:
@grimengine/core:test:
@grimengine/core:test:   [
@grimengine/core:test: -   20,
@grimengine/core:test: -   13,
@grimengine/core:test: +   14,
@grimengine/core:test: +   2,
@grimengine/core:test:   ]
@grimengine/core:test:
@grimengine/core:test:  ❯ tests/conditions.test.ts:114:32
@grimengine/core:test:     112|
@grimengine/core:test:     113|     const result = actorAttack(encounter, attacker.id, defender.id, { …
@grimengine/core:test:     114|     expect(result.attack.d20s).toEqual([20, 13]);
@grimengine/core:test:        |                                ^
@grimengine/core:test:     115|     expect(result.attack.natural).toBe(13);
@grimengine/core:test:     116|     expect(result.attack.expression).toContain('dis');
@grimengine/core:test:
@grimengine/core:test: ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/2]⎯
@grimengine/core:test:
@grimengine/core:test:  ELIFECYCLE  Test failed. See above for more details.
@grimengine/core:test: ERROR: command finished with error: command (C:\dev\grimengine\packages\core) C:\Users\gherr\AppData\Roaming\npm\pnpm.cmd run test exited (1)
@grimengine/core#test: command (C:\dev\grimengine\packages\core) C:\Users\gherr\AppData\Roaming\npm\pnpm.cmd run test exited (1)

 Tasks:    0 successful, 1 total
Cached:    0 cached, 1 total
  Time:    4.855s
Failed:    @grimengine/core#test

 ERROR  run failed: command  exited (1)
 ELIFECYCLE  Test failed. See above for more details.
PS C:\dev\grimengine>                                        