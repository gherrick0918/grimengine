PS C:\dev\grimengine> pnpm -w build; `
>> pnpm test; `
>> pnpm dev -- settings set auto-log on; `
>> pnpm dev -- campaign new greenway; `
>> pnpm dev -- campaign open greenway; `
>> pnpm run seed:characters; `
>> pnpm dev -- encounter start; `
>> pnpm dev -- character load-name "Bruni"; `
>> pnpm dev -- encounter add pc "Bruni"; `
>> pnpm dev -- encounter add goblin --n 2; `
>> pnpm dev -- encounter attack "Bruni" "Goblin #1"; `
>> pnpm dev -- death save "Goblin #1"; `
>> pnpm dev -- campaign note "Met goblins near the ford"; `
>> pnpm dev -- session tail --n 10; `
>> pnpm dev -- encounter end;

> grimengine@1.0.0 build C:\dev\grimengine
> turbo run build

turbo 2.5.8

• Packages in scope: @grimengine/cli, @grimengine/core, @grimengine/dnd5e-api, @grimengine/rules-srd
• Running build in 4 packages
• Remote caching disabled

No tasks were executed as part of this run.

 Tasks:    0 successful, 0 total
Cached:    0 cached, 0 total
  Time:    642ms

                                                                                                                                                     
> grimengine@1.0.0 test C:\dev\grimengine
> turbo run test

turbo 2.5.8

• Packages in scope: @grimengine/cli, @grimengine/core, @grimengine/dnd5e-api, @grimengine/rules-srd
• Running test in 4 packages
• Remote caching disabled
@grimengine/core:test: cache miss, executing c897e7a63b53b2c0
@grimengine/cli:test: cache miss, executing 5a7436400249403f
@grimengine/cli:test: 
@grimengine/cli:test: > @grimengine/cli@0.0.0 test C:\dev\grimengine\apps\cli
@grimengine/cli:test: > vitest --config vitest.config.ts
@grimengine/cli:test:
@grimengine/core:test:
@grimengine/core:test: > @grimengine/core@0.0.0 test C:\dev\grimengine\packages\core
@grimengine/core:test: > vitest --config vitest.config.ts
@grimengine/core:test:
@grimengine/cli:test: 
@grimengine/cli:test:  RUN  v3.2.4 C:/dev/grimengine/apps/cli
@grimengine/cli:test:
@grimengine/core:test: 
@grimengine/core:test:  RUN  v3.2.4 C:/dev/grimengine/packages/core
@grimengine/core:test:
@grimengine/core:test:  ✓ tests/combat.test.ts (8 tests) 11ms
@grimengine/core:test:  ✓ tests/initiative.test.ts (3 tests) 12ms
@grimengine/core:test:  ✓ tests/encounter.test.ts (3 tests) 16ms
@grimengine/core:test:  ✓ tests/conditions.test.ts (11 tests) 15ms
@grimengine/core:test:  ✓ tests/bless.test.ts (3 tests) 17ms
@grimengine/core:test:  ✓ tests/huntersMark.test.ts (4 tests) 15ms
@grimengine/core:test:  ✓ tests/spells.test.ts (9 tests) 17ms
@grimengine/cli:test:  ✓ tests/encounter-snapshots.test.ts (2 tests) 13ms
@grimengine/cli:test: 
@grimengine/cli:test:  Test Files  1 passed (1)
@grimengine/cli:test:       Tests  2 passed (2)
@grimengine/cli:test:    Start at  14:00:26
@grimengine/cli:test:    Duration  1.96s (transform 946ms, setup 0ms, collect 1.03s, tests 13ms, environment 0ms, prepare 451ms)
@grimengine/cli:test:
@grimengine/core:test:  ✓ tests/abilityScores.test.ts (9 tests) 12ms
@grimengine/core:test:  ✓ tests/tags.test.ts (3 tests) 12ms
@grimengine/core:test:  ✓ tests/weapons.test.ts (6 tests) 16ms
@grimengine/core:test:  ✓ tests/loot.test.ts (5 tests) 12ms
@grimengine/core:test:  ✓ tests/derived.test.ts (7 tests) 10ms
@grimengine/core:test:  ✓ tests/encounter-checks.test.ts (4 tests) 16ms
@grimengine/core:test:  ✓ tests/checks.test.ts (5 tests) 16ms
@grimengine/core:test:  ✓ tests/rest.test.ts (3 tests) 13ms
@grimengine/core:test:  ✓ tests/character.test.ts (6 tests) 13ms
@grimengine/core:test:  ✓ tests/advantage.wire.test.ts (7 tests) 18ms
@grimengine/core:test:  ✓ tests/reminders.test.ts (4 tests) 11ms
@grimengine/core:test:  ✓ tests/guidance_bi_reminders.test.ts (4 tests) 11ms
@grimengine/core:test:  ✓ tests/advdis.reminders.test.ts (3 tests) 10ms
@grimengine/core:test:  ✓ tests/slots.test.ts (5 tests) 11ms
@grimengine/core:test:  ✓ tests/death.test.ts (6 tests) 13ms
@grimengine/core:test:  ✓ tests/turns.duration.test.ts (3 tests) 9ms
@grimengine/core:test:  ❯ tests/logging.test.ts (3 tests | 2 failed) 79ms
@grimengine/core:test:    × logging helpers > appendLog writes to session log when no campaign 47ms
@grimengine/core:test:      → expected '.data\session-2025-10-16.md' to match /\.data\…/session-\d{4}-\d{2}-\d{2}\.md$
@grimengine/core:test:    × logging helpers > appendLog uses campaign-specific log file 8ms
@grimengine/core:test:      → expected '.data\campaigns\greenway-session-2025…' to match /\.data\/campaigns\/greenway…/campaigns\
@grimengine/core:test:    ✓ logging helpers > appendLog preserves chronological order for tailing 20ms
@grimengine/core:test:  ✓ tests/concentrationDamageReminders.test.ts (4 tests) 11ms
@grimengine/core:test:  ✓ tests/monster-normalize.test.ts (1 test) 7ms
@grimengine/core:test:  ✓ tests/dice.test.ts (4 tests) 9ms
@grimengine/core:test:  ✓ tests/skills.test.ts (4 tests) 14ms
@grimengine/core:test:  ✓ tests/conditions.reminders.test.ts (3 tests) 9ms
@grimengine/core:test:  ✓ tests/concentration.test.ts (3 tests) 7ms
@grimengine/core:test:  ✓ tests/bardicInspiration.consume.test.ts (2 tests) 8ms
@grimengine/core:test:  ✓ tests/derivationParity.test.ts (3 tests) 6ms
@grimengine/core:test: 
@grimengine/core:test: ⎯⎯⎯⎯⎯⎯⎯ Failed Tests 2 ⎯⎯⎯⎯⎯⎯⎯
@grimengine/core:test:
@grimengine/core:test:  FAIL  tests/logging.test.ts > logging helpers > appendLog writes to session log when no campaign
@grimengine/core:test: AssertionError: expected '.data\session-2025-10-16.md' to match /\.data\…/session-\d{4}-\d{2}-\d{2}\.md$
@grimengine/core:test:
@grimengine/core:test: - Expected:
@grimengine/core:test: /\.data\/session-\d{4}-\d{2}-\d{2}\.md$/
@grimengine/core:test:
@grimengine/core:test: + Received:
@grimengine/core:test: ".data\\session-2025-10-16.md"
@grimengine/core:test:
@grimengine/core:test:  ❯ tests/logging.test.ts:29:42
@grimengine/core:test:      27|     const contents = await fs.readFile(file, 'utf-8');
@grimengine/core:test:
@grimengine/core:test:      28|     expect(contents.trim().endsWith('opened the door')).toBe(true);
@grimengine/core:test:  Test Files  1 failed | 31 passed (32)
@grimengine/core:test:      29|     expect(path.relative(tempDir, file)).toMatch(/\.data\/session-\d{4…
@grimengine/core:test:       Tests  2 failed | 146 passed (148)
@grimengine/core:test:        |                                          ^
@grimengine/core:test:    Start at  14:00:26
@grimengine/core:test:      30|   });
@grimengine/core:test:      31|
@grimengine/core:test:    Duration  4.54s (transform 2.38s, setup 0ms, collect 4.69s, tests 455ms, environment 21ms, prepare 9.32s)
@grimengine/core:test:
@grimengine/core:test:
@grimengine/core:test: ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/2]⎯
@grimengine/core:test:
@grimengine/core:test:  FAIL  tests/logging.test.ts > logging helpers > appendLog uses campaign-specific log file
@grimengine/core:test: AssertionError: expected '.data\campaigns\greenway-session-2025…' to match /\.data\/campaigns\/greenway…/campaigns\
@grimengine/core:test:
@grimengine/core:test: - Expected:
@grimengine/core:test: /\.data\/campaigns\/greenway-session-\d{4}-\d{2}-\d{2}\.md$/
@grimengine/core:test:
@grimengine/core:test: + Received:
@grimengine/core:test: ".data\\campaigns\\greenway-session-2025-10-16.md"
@grimengine/core:test:
@grimengine/core:test:  ❯ tests/logging.test.ts:37:42
@grimengine/core:test:      35|     const contents = await fs.readFile(file, 'utf-8');
@grimengine/core:test:      36|     expect(contents.trim().endsWith('met the merchant')).toBe(true);
@grimengine/core:test:      37|     expect(path.relative(tempDir, file)).toMatch(/\.data\/campaigns\/g…
@grimengine/core:test:        |                                          ^
@grimengine/core:test:      38|   });
@grimengine/core:test:      39|
@grimengine/core:test:
@grimengine/core:test: ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/2]⎯
@grimengine/core:test:
@grimengine/core:test:  ELIFECYCLE  Test failed. See above for more details.
@grimengine/core:test: ERROR: command finished with error: command (C:\dev\grimengine\packages\core) C:\Users\gherr\AppData\Roaming\npm\pnpm.cmd run test exited (1)
@grimengine/core#test: command (C:\dev\grimengine\packages\core) C:\Users\gherr\AppData\Roaming\npm\pnpm.cmd run test exited (1)

 Tasks:    1 successful, 2 total
Cached:    0 cached, 2 total
  Time:    7.04s
Failed:    @grimengine/core#test

 ERROR  run failed: command  exited (1)
 ELIFECYCLE  Test failed. See above for more details.

> grimengine@1.0.0 dev C:\dev\grimengine
> tsx apps/cli/index.ts "settings" "set" "auto-log" "on"

autoLog = ON

> grimengine@1.0.0 dev C:\dev\grimengine
> tsx apps/cli/index.ts "campaign" "new" "greenway"

Campaign "greenway" already exists.
 ELIFECYCLE  Command failed with exit code 1.

> grimengine@1.0.0 dev C:\dev\grimengine
> tsx apps/cli/index.ts "campaign" "open" "greenway"

Campaign opened: greenway — party: (empty)
Encounter restored from snapshot.

> grimengine@1.0.0 seed:characters C:\dev\grimengine
> tsx tools/seed-characters.ts

Seeded Bruni -> .data\characters\Bruni.json
Seeded Kara -> .data\characters\Kara.json

> grimengine@1.0.0 dev C:\dev\grimengine
> tsx apps/cli/index.ts "encounter" "start"

Encounter started.

> grimengine@1.0.0 dev C:\dev\grimengine
> tsx apps/cli/index.ts "character" "load-name" "Bruni"

Loaded character Bruni (lvl 3). PB +2

> grimengine@1.0.0 dev C:\dev\grimengine
> tsx apps/cli/index.ts "encounter" "add" "pc" "Bruni"

Added PC Bruni (id=bruni).

> grimengine@1.0.0 dev C:\dev\grimengine
> tsx apps/cli/index.ts "encounter" "add" "goblin" "--n" "2"

Added 2 Goblins on side 'foe': Goblin #1 (id=goblin-1), Goblin #2 (id=goblin-2)

> grimengine@1.0.0 dev C:\dev\grimengine
> tsx apps/cli/index.ts "encounter" "attack" "Bruni" "Goblin #1"

Mode: melee (conditions: none)
Advantage state: normal
Attack: 1d20+4 vs AC 15
Rolls: [7] → natural 7 → total 11 → MISS
Defender Goblin #1 (id=goblin-1) now has 7/7 HP (active).

> grimengine@1.0.0 dev C:\dev\grimengine
> tsx apps/cli/index.ts "death" "save" "Goblin #1"

Goblin #1 is conscious (no death save needed). (roll=1)

> grimengine@1.0.0 dev C:\dev\grimengine
> tsx apps/cli/index.ts "campaign" "note" "Met goblins near the ford"

Note appended.

> grimengine@1.0.0 dev C:\dev\grimengine
> tsx apps/cli/index.ts "session" "tail" "--n" "10"

- 2025-10-16T18:00:36.730Z Encounter started.
- 2025-10-16T18:00:38.309Z Added Bruni (party).
- 2025-10-16T18:00:39.127Z Added Goblin #1 (foe).
- 2025-10-16T18:00:39.129Z Added Goblin #2 (foe).
- 2025-10-16T18:00:39.969Z Bruni attacked Goblin #1: missed vs AC 15 (roll 11).
- 2025-10-16T18:00:40.774Z Goblin #1 is conscious (no death save needed). (roll=1)

> grimengine@1.0.0 dev C:\dev\grimengine
> tsx apps/cli/index.ts "encounter" "end"

Encounter ended.
PS C:\dev\grimengine> 